---
title: psqlのページャーにovを！
tags:
  - PostgreSQL
  - AdventCalendar2024
private: true
updated_at: '2024-12-05T21:08:13+09:00'
id: 6ac19b754f896e41197c
organization_url_name: null
slide: false
ignorePublish: false
---
この記事は、[2024年Advent Calendar](https://qiita.com/advent-calendar/2024/postgresql)の12月6日の記事その2です。

## lessページャー

psqlではSQLを実行して結果が画面に収まらない場合、ページャーが起動して結果を表示します。
起動するページャーは、環境変数`PAGER`に設定されているコマンドです。多くの場合は`less`が使用されます。

`less`は昔からあり、安定していて、完成して機能追加もされていない...と思っていませんか？
実は、`less`は今も開発が進んでいて、新しい機能が追加されています。`less`のバージョンを確認して、603以上であれば、大きな機能追加がされています。

```console
less --version
less 671x (GNU regular expressions)
```

※ ここでは開発版の671xを使用しています。603以上であれば使えるはずですが、多少動作は違うかもしれません。

psqlを起動して、`SELECT * FROM pg_class;`を実行してみましょう。

![通常のless](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/18555/d3442a41-eb9a-f32b-6444-c464c44d2a2e.png)

画面に収まらないので、カラム名と区切り線と最初の方のデータしか表示されていません。ここで表示をとどめておいて、スクロールして表示できるようにしているのがページャーです。
そして、通常はスクロールしていくと、カラム名や区切り線もスクロールで消えていきデータだけが表示されます。
ページャーとは表示する中身に関係なく、１画面分を表示するためのもの...だったのは昔の話です。

その画面のまま`--header`と打ってみましょう。これは`less`のオプションを起動後に指定して切り替えています。

`Header lines:`とプロンプトが出るので、2と入力してEnterを押してください。

折返し表示がなくなり横スクロールするマークが表示されるようになっています。
これで上の2行（カラム名と区切り線）はヘッダーとして常に表示されるようになります。

![ヘッダー付きless](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/18555/d07ec2c8-ab09-3870-d1c9-2eef9602cef8.png)

![ヘッダー付きless2](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/18555/58d6ac07-55eb-3890-2a7f-a04bc78f538a.png)

今までたくさんのカラムを表示していたときには\xを使用するといった方法がありましたが、ページャーの機能により見やすくなることがわかりました。

まだ不満がありますか？ そこで[ov](https://github.com/noborus/ov)をおすすめします。

## その前にpspg

psqlの結果表示を改善するために、`pspg`を使うこともできます。
[pspg](https://github.com/okbob/pspg)

`pspg`はカラム名の固定やカラムを固定して表示することができます。もともとPostgreSQL用として作られたようですが、表形式のデータを表示するために便利に使えます。

psqlを使用していてページャーを`pspg`にしている方も多いです。

## ovページャー

[ov](https://github.com/noborus/ov)は、ターミナル上で動作するページャーで、特に大きなテキストファイルやログファイルを閲覧するのに適しています。`ov`はPostgreSQLの`psql`コマンドと組み合わせて使用することができ、結果の表示をより見やすくすることができます。

### インストール

まず、`ov`をインストールします。以下のコマンドを実行してください。

```sh
go install github.com/noborus/ov@latest
```

### 設定

次に、psqlのページャーとしてovを設定します。以下のコマンドを実行して、環境変数PAGERをovに設定します。

この設定を永続化するために、~/.bashrcや~/.zshrcなどのシェルの設定ファイルに追加することをお勧めします。

### 使用方法

psqlを起動して、クエリを実行すると、結果がovページャーで表示されます。例えば、以下のようにクエリを実行します。

これで、ovページャーを使用して結果をスクロールしたり、検索したりすることができます。

詳細な使い方やオプションについては、公式ドキュメントを参照してください。

### まとめ

psqlの結果表示を改善するために、lessのオプションやpspg、ovなどのページャーを活用することができます。これらのツールを使うことで、大量のデータをより見やすく、効率的に扱うことができます。ぜひ試してみてください。 
